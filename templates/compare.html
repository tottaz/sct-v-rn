{% extends "base.html" %}
{% block content %}
<h2>Compare Reports</h2>

<form method="POST" class="mb-3">
    <div class="mb-3">
        <label for="report1">Select Report 1</label>
        <select name="report1" id="report1" class="form-select" required>
            <option value="">-- Choose --</option>
            {% for r in reports %}
                <option value="{{ r }}">{{ r }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="mb-3">
        <label for="report2">Select Report 2</label>
        <select name="report2" id="report2" class="form-select" required>
            <option value="">-- Choose --</option>
            {% for r in reports %}
                <option value="{{ r }}">{{ r }}</option>
            {% endfor %}
        </select>
    </div>

    <button type="submit" class="btn btn-primary">Analyze & Compare</button>
</form>

{% if diff %}
<div class="mt-4">
    <h4>Comparison Result</h4>
    <div class="card p-3 bg-light mb-3">
        <h5>New Findings in Report 2</h5>
        <ul>
            {% for f in diff.new_findings %}
            <li>{{ f }}</li>
            {% else %}
            <li>No new findings</li>
            {% endfor %}
        </ul>

        <h5>Resolved Findings from Report 1</h5>
        <ul>
            {% for f in diff.resolved_findings %}
            <li>{{ f }}</li>
            {% else %}
            <li>No resolved findings</li>
            {% endfor %}
        </ul>
    </div>

    <h4>Score Card</h4>
    <table class="table table-sm table-bordered">
        <tr><th>Metric</th><th>Value</th></tr>
        <tr><td>Report 1 Issues</td><td>{{ score_card.report1_issues }}</td></tr>
        <tr><td>Report 2 Issues</td><td>{{ score_card.report2_issues }}</td></tr>
        <tr><td>New Issues</td><td>{{ score_card.new_issues }}</td></tr>
        <tr><td>Resolved Issues</td><td>{{ score_card.resolved_issues }}</td></tr>
    </table>

    <h4>AI Explanation</h4>
    <div class="card p-3 bg-light" style="white-space: pre-wrap;">
        {{ explanation | safe }}
    </div>
</div>
{% endif %}
{% endblock %}
